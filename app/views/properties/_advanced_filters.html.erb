<!-- Advanced Search Filters Sidebar -->
<div class="bg-white rounded-2xl shadow-sm" data-controller="property-filters">
  <div class="p-4 lg:p-6 max-h-[calc(100vh-200px)] overflow-y-auto">
    <%= form_with url: properties_path, method: :get, local: false, data: { "property-filters-target": "form" } do |f| %>

    <!-- Listing Type Toggle -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3">I'm looking to</h3>
      <div class="grid grid-cols-2 gap-2">
        <label class="relative">
          <%= radio_button_tag :listing_type, "sale", params[:listing_type] == "sale" || params[:listing_type].blank?,
              class: "peer sr-only" %>
          <div class="text-center px-4 py-2 rounded-lg cursor-pointer
                      peer-checked:bg-blue-500 peer-checked:text-white
                      bg-gray-50">
            Buy
          </div>
        </label>
        <label class="relative">
          <%= radio_button_tag :listing_type, "rent", params[:listing_type] == "rent",
              class: "peer sr-only" %>
          <div class="text-center px-4 py-2 rounded-lg cursor-pointer
                      peer-checked:bg-blue-500 peer-checked:text-white
                      bg-gray-50">
            Rent
          </div>
        </label>
      </div>
    </div>

    <!-- Price Range with DaisyUI - Dynamic Context Aware -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3" data-property-filters-target="priceRangeTitle">
        Price Range
      </h3>
      <div class="space-y-4">
        <!-- Min Price -->
        <div>
          <label class="text-sm text-gray-600" data-property-filters-target="minPriceText">Min Price: $<span data-property-filters-target="minPriceLabel">0</span></label>
          <%= range_field_tag :min_price, params[:min_price] || 0,
              min: 0, max: 2000000, step: 10000,
              class: "range range-primary range-sm w-full",
              data: {
                "property-filters-target": "minRange"
              } %>
        </div>

        <!-- Max Price -->
        <div>
          <label class="text-sm text-gray-600" data-property-filters-target="maxPriceText">Max Price: $<span data-property-filters-target="maxPriceLabel">2,000,000</span></label>
          <%= range_field_tag :max_price, params[:max_price] || 2000000,
              min: 0, max: 2000000, step: 10000,
              class: "range range-primary range-sm w-full",
              data: {
                "property-filters-target": "maxRange"
              } %>
        </div>
        <!-- Quick Price Options - Dynamic -->
        <div class="grid grid-cols-2 gap-2 text-xs" data-property-filters-target="quickButtons">
          <!-- JavaScript will populate these buttons based on listing type -->
        </div>
      </div>
    </div>

    <!-- Property Type -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3">Property Type</h3>
      <div class="space-y-2">
        <% ['House', 'Apartment', 'Condo', 'Townhouse', 'Land', 'Commercial'].each do |type| %>
          <label class="flex items-center cursor-pointer p-2 rounded">
            <%= check_box_tag "property_types[]", type,
                params[:property_types]&.include?(type),
                class: "rounded-md text-blue-600 focus:ring-blue-500 focus:ring-offset-0 border-gray-200" %>
            <span class="ml-2 text-sm text-gray-700"><%= type %></span>
          </label>
        <% end %>
      </div>
    </div>

    <!-- Bedrooms & Bathrooms -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3">Bedrooms & Bathrooms</h3>

      <!-- Bedrooms -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Bedrooms</label>
        <div class="grid grid-cols-5 gap-1">
          <% ['Any', '1+', '2+', '3+', '4+'].each_with_index do |label, index| %>
            <label class="relative">
              <%= radio_button_tag :bedrooms, index == 0 ? '' : index,
                  params[:bedrooms].to_s == (index == 0 ? '' : index.to_s),
                  class: "peer sr-only" %>
              <div class="text-center px-2 py-1 text-sm rounded-lg cursor-pointer
                          peer-checked:bg-blue-500 peer-checked:text-white
                          bg-gray-50">
                <%= label %>
              </div>
            </label>
          <% end %>
        </div>
      </div>

      <!-- Bathrooms -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Bathrooms</label>
        <div class="grid grid-cols-5 gap-1">
          <% ['Any', '1+', '2+', '3+', '4+'].each_with_index do |label, index| %>
            <label class="relative">
              <%= radio_button_tag :bathrooms, index == 0 ? '' : index,
                  params[:bathrooms].to_s == (index == 0 ? '' : index.to_s),
                  class: "peer sr-only" %>
              <div class="text-center px-2 py-1 text-sm rounded-lg cursor-pointer
                          peer-checked:bg-blue-500 peer-checked:text-white
                          bg-gray-50">
                <%= label %>
              </div>
            </label>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Square Feet -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3">Square Feet</h3>
      <div class="grid grid-cols-2 gap-2">
        <%= number_field_tag :min_sqft, params[:min_sqft],
            placeholder: "Min",
            class: "px-3 py-2 bg-gray-50 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none" %>
        <%= number_field_tag :max_sqft, params[:max_sqft],
            placeholder: "Max",
            class: "px-3 py-2 bg-gray-50 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none" %>
      </div>
    </div>

    <!-- Additional Features -->
    <div class="mb-5">
      <h3 class="text-base font-semibold text-gray-900 mb-3">Features</h3>
      <div class="space-y-2">
        <% [
          ['featured', 'Featured Properties'],
          ['parking', 'Parking Available'],
          ['pet_friendly', 'Pet Friendly'],
          ['furnished', 'Furnished'],
          ['pool', 'Swimming Pool'],
          ['garden', 'Garden']
        ].each do |value, label| %>
          <label class="flex items-center cursor-pointer p-2 rounded">
            <%= check_box_tag "features[]", value,
                params[:features]&.include?(value),
                class: "rounded-md text-blue-600 focus:ring-blue-500 focus:ring-offset-0 border-gray-200" %>
            <span class="ml-2 text-sm text-gray-700"><%= label %></span>
          </label>
        <% end %>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-2">
      <%= button_tag type: "submit",
          class: "flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium" do %>
        Apply Filters
      <% end %>

      <%= link_to "Clear All", properties_path,
          class: "flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-center font-medium" %>
    </div>

    <!-- Active Filters Count -->
    <% active_filters = 0 %>
    <% active_filters += 1 if params[:listing_type].present? %>
    <% active_filters += 1 if params[:min_price].present? || params[:max_price].present? %>
    <% active_filters += params[:property_types]&.length.to_i %>
    <% active_filters += 1 if params[:bedrooms].present? %>
    <% active_filters += 1 if params[:bathrooms].present? %>
    <% active_filters += 1 if params[:min_sqft].present? || params[:max_sqft].present? %>
    <% active_filters += params[:features]&.length.to_i %>

    <% if active_filters > 0 %>
      <div class="mt-4 text-center">
        <span class="text-sm text-gray-600">
          <span class="font-semibold text-blue-600"><%= active_filters %></span>
          filter<%= 's' if active_filters > 1 %> active
        </span>
      </div>
    <% end %>
  <% end %>
  </div>
</div>